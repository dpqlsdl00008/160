var status = 0;
var bookList = [];
var coinId = 4310031;
var requiredCoins = 0;

function start() {
    status = -1;
    action(1, 0, 0);
}

function action(mode, type, selection) {
    if (mode == -1 || (mode == 0 && status <= 0)) {
        cm.dispose();
        return;
    }

    if (mode == 1) status++;
    else status--;

    if (status == 0) {
        cm.sendSimple(
            "#Cyellow#보스 원정대 코인#Cgray#을 가져오면 \r\n마스터리북으로 교환해주고 있다네.\r\n\r\n" +
            "#L0# #Cgreen#20레벨 #Cgray#마스터리북 교환 [코인 #Cgreen#5개#Cgray#]#l\r\n" +
            "#L1# #d30레벨 #Cgray#마스터리북 교환 [코인 #d30개#Cgray#]#l"
        );
    } else if (status == 1) {
        var level = selection == 0 ? 20 : 30;
        requiredCoins = selection == 0 ? 5 : 30;

        var job = cm.getJob();
        bookList = getMasteryBooks(job, level);

        if (bookList.length == 0) {
            cm.sendOk("흠..처음 보는 직업이구만?? 자네의 마스터리북은 가지고 있지 않다네.");
            cm.dispose();
            return;
        }

        var msg = "#k원하는 마스터리북을 선택하시게.\r\n\r\n";
for (var i = 0; i < bookList.length; i++) {
    var itemId = bookList[i][0];
    msg += "#L" + i + "# #b#z" + itemId + "##l\r\n\r\n";
}
        cm.sendSimple(msg);
    } else if (status == 2) {
        var chosenBook = bookList[selection][0];

        if (!cm.haveItem(coinId, requiredCoins)) {
            cm.sendOk("#r보스 원정대 코인#k이 부족한건 아닌지 확인해 보게. \r\n(" + requiredCoins + "개 필요)");
            cm.dispose();
            return;
        }

        cm.gainItem(coinId, -requiredCoins);
        cm.gainItem(chosenBook, 1);
        cm.sendOk("마스터리북을 지급했네. 행운을 빌지.");
        cm.dispose();
    }
}

function getMasteryBooks(job, level) {
    var list = [];

    if (job >= 110 && job <= 112) { // 히어로
        if (level == 20) {
            list = [
                [2290008], [2290000], [2290006], [2290004], [2290599], [2290016], [2290064]
            ];
        } else if (level == 30) {
            list = [
                [2290009], [2290001], [2290007], [2290005], [2290600], [2290017], [2290065]
            ];
        }
    } else if (job >= 120 && job <= 122) { // 팔라딘
        if (level == 20) {
            list = [
                [2290000], [2290002], [2290014], [2290012], [2290006], [2290004], [2290020]
            ];
        } else if (level == 30) {
            list = [
                [2290001], [2290003], [2290015], [2290013], [2290007], [2290005], [2290021]

            ];
        }
    } else if (job >= 130 && job <= 132) { // 다크나이트
        if (level == 20) {
            list = [
                [2290022], [2290000], [2290006], [2290004], [2290292] 
            ];
        } else if (level == 30) {
            list = [
                [2290023], [2290001], [2290007], [2290005], [2290293] 
            ];
        }
    } else if (job >= 210 && job <= 212) { // 불독
        if (level == 20) {
            list = [
                [2290026], [2290028], [2290036], [2290038], [2290030], [2290040], [2290024]
            ];
        } else if (level == 30) {
            list = [
                [2290027], [2290029], [2290037], [2290039], [2290031], [2290041], [2290025]
            ];
        }
    } else if (job >= 220 && job <= 222) { // 썬콜
        if (level == 20) {
            list = [
                [2290026], [2290028], [2290034], [2290050], [2290206], [2290048], [2290024]
            ];
        } else if (level == 30) {
            list = [
                [2290027], [2290029], [2290035], [2290051], [2290207], [2290049], [2290025]
            ];
        }
    } else if (job >= 230 && job <= 232) { // 비숍
        if (level == 20) {
            list = [
                [2290026], [2290028], [2290034], [2290050], [2290206], [2290048], [2290024]
            ];
        } else if (level == 30) {
            list = [
                [2290027], [2290029], [2290035], [2290051], [2290207], [2290049], [2290025]
            ];
        }
    } else if (job >= 310 && job <= 312) { // 보마
        if (level == 20) {
            list = [
                [2290056], [2290052], [2290060], [2290058], [2290062], [2290064]
            ];
        } else if (level == 30) {
            list = [
                [2290057], [2290053], [2290061], [2290059], [2290063], [2290065]
            ];
        }
    } else if (job >= 320 && job <= 322) { // 신궁
        if (level == 20) {
            list = [
                [2290066], [2290052], [2290070], [2290058], [2290072], [2290074]
            ];
        } else if (level == 30) {
            list = [
                [2290067], [2290053], [2290071], [2290059], [2290073], [2290075]
            ];
        }
    } else if (job >= 410 && job <= 412) { // 나로
        if (level == 20) {
            list = [
                [2290076], [2290412], [2290416], [2290418], [2290420], [2290414]
            ];
        } else if (level == 30) {
            list = [
                [2290077], [2290413], [2290417], [2290419], [2290421], [2290415]
            ];
        }
    } else if (job >= 420 && job <= 422) { // 섀도어
        if (level == 20) {
            list = [
                [2290092], [2290076], [2290094], [2290090], [2290414], [2290424]
            ];
        } else if (level == 30) {
            list = [
                [2290093], [2290077], [2290095], [2290091], [2290415], [2290425]
            ];
        }
    } else if (job >= 510 && job <= 512) { // 바이퍼
        if (level == 20) {
            list = [
                [2290097], [2290434], [2290324], [2290432], [2290430]
            ];
        } else if (level == 30) {
            list = [
                [2290098], [2290435], [2290325], [2290433], [2290431]
            ];
        }
    } else if (job >= 520 && job <= 522) { // 캡틴
        if (level == 20) {
            list = [
                [2290117], [2290324], [2290441], [2290439], [2290436]
            ];
        } else if (level == 30) {
            list = [
                [2290118], [2290325], [2290442], [2290440], [2290437]
            ];
        }
    } else if (job >= 5110 && job <= 5112) { // 미하일
        if (level == 20) {
            list = [
                [2290591], [2290589], [2290290], [2290595], [2290597], [2290593], [2290006]
            ];
        } else if (level == 30) {
            list = [
                [2290592], [2290590], [2290291], [2290596], [2290598], [2290594], [2290007]
            ];
        }
    } else if (job >= 430 && job <= 434) { // 듀얼블레이드
        if (level == 20) {
            list = [
                [2290414]
            ];
        } else if (level == 30) {
            list = [
                [2290415]
            ];
        }
    } else if (job >= 530 && job <= 534) { // 캐논 슈터
        if (level == 20) {
            list = [
                [2290322], [2290331], [2290324], [2290326], [2290333], [2290329]
            ];
        } else if (level == 30) {
            list = [
                [2290323], [2290332], [2290325], [2290327], [2290334], [2290330]
            ];
        }
    } else if (job >= 2110 && job <= 2112) { // 아란
        if (level == 20) {
            list = [
                [2290126], [2290132], [2290136], [2290378]
            ];
        } else if (level == 30) {
            list = [
                [2290127], [2290133], [2290137], [2290379]
            ];
        }
    } else if (job >= 2200 && job <= 2218) { // 에반
        if (level == 20) {
            list = [
                [2290144], [2290140], [2290142], [2290146], [2290148]
            ];
        } else if (level == 30) {
            list = [
                [2290145], [2290141], [2290143], [2290147], [2290149]
            ];
        }
    } else if (job >= 2310 && job <= 2312) { // 메르세데스
        if (level == 20) {
            list = [
                [2290340], [2290343], [2290345], [2290347], [2290064]
            ];
        } else if (level == 30) {
            list = [
                [2290341], [2290344], [2290346], [2290348], [2290065]
            ];
        }
    } else if (job >= 2410 && job <= 2412) { // 팬텀
        if (level == 20) {
            list = [
                [2290512], [2290514], [2290517], [2290519], [2290521], [2290516], [2290523]
            ];
        } else if (level == 30) {
            list = [
                [2290513], [2290515], [2290518], [2290520], [2290522]
            ];
        }
    } else if (job >= 3210 && job <= 3212) { // 배틀메이지
        if (level == 20) {
            list = [
                [2290230], [2290232], [2290234], [2290226], [2290228], [2290236], [2290359]
            ];
        } else if (level == 30) {
            list = [
                [2290231], [2290233], [2290235], [2290227], [2290229], [2290237], [2290360]
            ];
        }
    } else if (job >= 3510 && job <= 3512) { // 메카닉
        if (level == 20) {
            list = [
                [2290278], [2290282], [2290275], [2290279]
            ];
        } else if (level == 30) {
            list = [
                [2290279], [2290283], [2290276], [2290280]
            ];
        }
    } else if (job >= 3310 && job <= 3312) { // 와일드 헌터
        if (level == 20) {
            list = [
                [2290240], [2290242], [2290238], [2290066], [2290052], [2290370]
            ];
        } else if (level == 30) {
            list = [
                [2290241], [2290243], [2290239], [2290067], [2290053], [2290411]
            ];
        }
    } else if (job >= 3110 && job <= 3112) { // 데몬 슬레이어
        if (level == 20) {
            list = [
                [2290354], [2290356], [2290361], [2290364], [2290366]
            ];
        } else if (level == 30) {
            list = [
                [2290355], [2290357], [2290362], [2290365], [2290367]
            ];
        }
    } else if (job >= 6110 && job <= 6112) { // 하야토
        if (level == 20) {
            list = [
                [2290166], [2290168], [2290162], [2290164], [2290174]
            ];
        } else if (level == 30) {
            list = [
                [2290167], [2439838], [2439839], [2290169], [2290163], [2290165], [2439840], [2439841], [2290175]
            ];
        }
    } else if (job >= 6210 && job <= 6212) { // 칸나
        if (level == 20) {
            list = [
                [2290184], [2290181], [2290176], [2290178], [2290183], [2290180], [2290186]
            ];
        } else if (level == 30) {
            list = [
                [2290185], [2290182], [2290177], [2290179], [2290184], [2290181], [2290187]
            ];
        }
    } else if (job >= 6510 && job <= 6512) { // 묵현
        if (level == 20) {
            list = [
                [2290188], [2290192], [2290194], [2290196]
            ];
        } else if (level == 30) {
            list = [
                [2290189], [2290193], [2290195], [2290197]
            ];
        }
    }






















    return list;
}